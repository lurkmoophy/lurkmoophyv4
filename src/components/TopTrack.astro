---
// Simple vanilla TopTrack component for Header
---

<div class="top-track" id="top-track-container">
  <div id="loading">ðŸŽµ Loading...</div>
  <div id="track-content" style="display: none;">
    <a href="#" target="_blank" rel="noopener" id="track-link">
      <img id="track-image" alt="Track cover" width="32" height="32" loading="lazy" style="display: none;" />
      <span id="track-text"></span>
    </a>
  </div>
  <div id="no-track" style="display: none;">
    <span>No recent plays</span>
  </div>
</div>

<script>
  // Simple function to load and display top track
  async function loadTopTrack() {
    try {
      const res = await fetch('/.netlify/functions/top-track');
      const data = await res.json();
      
      const loadingEl = document.getElementById('loading');
      const trackContentEl = document.getElementById('track-content');
      const noTrackEl = document.getElementById('no-track');
      
      if (data.track) {
        // Show track data
        document.getElementById('track-link').href = data.track.url;
        document.getElementById('track-text').textContent = `${data.track.artist} - ${data.track.name}`;
        
        if (data.track.image) {
          const imgEl = document.getElementById('track-image');
          imgEl.src = data.track.image;
          imgEl.alt = `${data.track.artist} â€” ${data.track.name}`;
          imgEl.style.display = 'block';
        }
        
        loadingEl.style.display = 'none';
        trackContentEl.style.display = 'flex';
      } else {
        // Show no track message
        loadingEl.style.display = 'none';
        noTrackEl.style.display = 'block';
      }
    } catch (error) {
      console.error('Error loading top track:', error);
      document.getElementById('loading').textContent = 'Error loading track';
    }
  }
  
  // Load when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadTopTrack);
  } else {
    loadTopTrack();
  }
</script>

<style>
.top-track { 
  display: flex; 
  gap: 0.5rem; 
  align-items: center; 
  font-size: 0.875rem;
  color: var(--grey);
}
.top-track img { 
  border-radius: 4px; 
  width: 32px;
  height: 32px;
  object-fit: cover;
}
.top-track a { 
  display: flex; 
  gap: 0.5rem; 
  text-decoration: none; 
  color: inherit;
  align-items: center;
}
.top-track a:hover {
  color: var(--black);
}
</style>
