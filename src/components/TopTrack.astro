---
// TopTrack.astro - Client-side component
---

<div class="top-track">
  <p>Current obsession: </p>
  <img src="/images/spotify-pixel.svg">
  <a href="#" class="track-name track-link">Loading...</a>
</div>

<style>
  .top-track {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .top-track img {
    width: auto;
    height: 20px;
  }
  
  .track-name {
    font-size: inherit;
    color: var(--grey);
  }
  .track-name:hover {
    color: var(--black);
  }
</style>

<script>
  (async function() {
    try {
      const response = await fetch('/.netlify/functions/top-track');
      
      if (!response.ok) {
        throw new Error('Failed to fetch top track');
      }
      
      const data = await response.json();
      
      // Update all instances of the track link (for marquee duplicates)
      const linkElements = document.querySelectorAll('.track-link');
      
      linkElements.forEach((element) => {
        element.href = data.url || '#';
        element.textContent = `${data.artist} - ${data.name}` || 'No track data';
      });
    } catch (error) {
      console.error('Error fetching top track:', error);
      const linkElements = document.querySelectorAll('.track-link');
      linkElements.forEach((element) => {
        element.textContent = 'No track data';
      });
    }
  })();
</script>