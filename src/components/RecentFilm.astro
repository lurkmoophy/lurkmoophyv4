---
// RecentFilm.astro - Client-side component
const username = 'lurkmoophy';
---

<div class="recent-film">
  <p>Most recent film: </p>
  <a href="#" target="_blank" rel="noopener noreferrer" class="film-link">
    <p class="film-title">Loading...</p>
  </a>
</div>

<style>
  .recent-film {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }
  
  .film-title {
    font-size: inherit;
    color: var(--grey);
  }
  
  .recent-film a {
    color: var(--grey);
  }
  
  .recent-film a:hover .film-title {
    color: var(--black);
  }
</style>

<script>
  (async function() {
    try {
      const response = await fetch('/.netlify/functions/recent-film');
      
      if (!response.ok) {
        throw new Error('Failed to fetch recent film');
      }
      
      const data = await response.json();
      
      // Update all instances of the film title and link (for marquee duplicates)
      const titleElements = document.querySelectorAll('.film-title');
      const linkElements = document.querySelectorAll('.film-link');
      
      titleElements.forEach((element) => {
        element.textContent = data.title || 'No recent film';
      });
      
      linkElements.forEach((element) => {
        element.href = data.link || '#';
      });
    } catch (error) {
      console.error('Error fetching recent film:', error);
      const titleElements = document.querySelectorAll('.film-title');
      titleElements.forEach((element) => {
        element.textContent = 'No recent film';
      });
    }
  })();
</script>